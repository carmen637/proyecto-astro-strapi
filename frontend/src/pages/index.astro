---
import Layout from '../layouts/Layout.astro';
import Button from '../components/Button.astro';
---

<Layout>

<section class="relative h-screen flex items-center justify-center overflow-hidden bg-gradient-to-b from-[#0B0F2A] via-[#0f172a] to-[#050814]">
  <canvas id="stars" class="absolute inset-0 w-full h-full"></canvas>
  <div class="absolute inset-0 bg-black/40"></div>
  
  <div class="relative z-10 text-center text-white px-6">
    <h1>Biblioteca <span class="text-[#FACC15]">Arcana</span></h1>
    <p class="mx-auto">Sabiduría antigua para almas modernas</p>
    <Button type="outline" href="/libros" class="btn-outline mt-6">Explorar colección</Button>
  </div>
</section>

<section class="py-24 bg-[#0B0F2A] text-white">
  <div class="max-w-6xl mx-auto px-6 text-center">
    <h2 class="text-4xl font-serif mb-4">Tradiciones Esotéricas</h2>
    <p class="text-gray-400 mb-16">Explora los diferentes caminos del conocimiento místico</p>
    
    <div id="tradiciones-grid" class="grid gap-6" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
      <!-- Se llenarán con JavaScript -->
    </div>
  </div>
</section>

<script>
  // Script de estrellas
  const canvas = document.getElementById("stars");
  const ctx = canvas.getContext("2d");
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener("resize", resize);
  let stars = [];
  for (let i = 0; i < 150; i++) {
    stars.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      radius: Math.random() * 1.5,
      alpha: Math.random(),
      speed: Math.random() * 0.2
    });
  }
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    stars.forEach(star => {
      star.y += star.speed;
      if (star.y > canvas.height) star.y = 0;
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(255,255,255,${star.alpha})`;
      ctx.fill();
    });
    requestAnimationFrame(draw);
  }
  draw();

  // Cargar tradiciones
  fetch('http://18.201.196.247:1337/api/libros')
    .then(res => res.json())
    .then(data => {
      const tradiciones = [...new Set(data.data.map(libro => libro.tradicion))];
      const grid = document.getElementById('tradiciones-grid');
      grid.innerHTML = tradiciones.map(tradicion => `
        <a href="/libros?tradicion=${encodeURIComponent(tradicion)}">
          <div class="bg-[#111827] p-8 rounded-xl border border-white/10 hover:border-[#D4AF37] transition duration-300 cursor-pointer">
            <h3 class="text-xl font-semibold text-white">${tradicion}</h3>
          </div>
        </a>
      `).join('');
    });
</script>
</Layout>